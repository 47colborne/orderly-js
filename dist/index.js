!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Orderly",[],e):"object"==typeof exports?exports.Orderly=e():t.Orderly=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";t.exports=n(2)},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(){function t(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=new c["default"](t,e),r=new f["default"]({action:n.execute,priority:e.priority});return y.add(r),n}function e(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return t(e,o({},n,{method:"GET"}))}function n(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return t(e,o({},n,{method:"POST"}))}function r(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return t(e,o({},n,{method:"PUT"}))}function i(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return t(e,o({},n,{method:"DELETE"}))}var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],s=a.debug,l=a.max,p=a.sleep;(0,u.setMode)(s);var y=new d["default"],v=new h["default"](y,{max:l,sleep:p});return{ajax:t,get:e,post:n,put:r,del:i,queue:y,worker:v}}Object.defineProperty(e,"__esModule",{value:!0});var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u=n(3),a=n(4),c=r(a),s=n(9),f=r(s),l=n(10),d=r(l),p=n(13),h=r(p);e["default"]=i},function(t,e){"use strict";function n(t){return u=t}function r(){return u}function i(t,e){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(u){var r=Object.keys(n).reduce(function(t,e){var r=n[e];return"object"===("undefined"==typeof r?"undefined":o(r))&&(r=JSON.stringify(r)),t+" "+e+":"+r},t);r=r+" "+e,console.log(r)}}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},u=!1;e.setMode=n,e.getMode=r,e.log=i},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function u(t,e,n){(0,j.log)("Ajax",t,{url:e.key,id:e.id,priority:n})}function a(t,e){return t.some(function(t){return t(e)})}function c(t,e){return a(t)||e.sentIsOutdated()}function s(t,e,n,r){return a(e,t)||n.receivedIsOutdated()?(u("CANCELLED",n,priority),t=m({},t,{status:q}),r(t)):void u("RECEIVED",n,priority)}function f(t,e,n){t[e]=n}function l(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return function(e){return t.apply(void 0,[e].concat(n)),e}}function d(t,e){return new Headers(m({},t,x["default"].request(e)))}function p(t,e){return t&&"json"===e?JSON.stringify(t):t}function h(t,e){var n=e.headers,r=e.body,i=e.type,u=o(e,["headers","body","type"]);return n=d(n,i),r=p(r,i),new Request(t,m({},u,{headers:n,body:r}))}function y(t,e,n){var r=e.type,i=e.priority;return function(e,o){return function(a){return c(a,n)?(u("SKIPPED",n,i),o({status:E})):(n.sent(),u("SENT",n,i),fetch(t).then(l(s,a,n,o)).then(l(n.received)).then(l(f,S,n.toString())).then(x["default"].parse(r)).then(e)["catch"](o))}}}function v(t,e){return function(){return t(e)}}Object.defineProperty(e,"__esModule",{value:!0});var b=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),m=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},g=n(5),k=r(g),w=n(6),x=r(w),O=n(7),j=n(3),P=n(8),_=r(P),E="skipped",q="cancelled",S="_v",z=function(){function t(e){var n=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=r.version,c=o(r,["version"]);i(this,t),a=new _["default"]((0,O.filterParams)(e),a);var s=h(e,c),f=y(s,c,a);this.conditions=[],this.q=new Promise(function(t,e){f=f(t,e),n.execute=v(f,n.conditions)}),u("CREATED",a,c.priority)}return b(t,[{key:"cancel",value:function(t){return this.conditions.push(t),this}},{key:"catch",value:function(t){return this.q=this.q["catch"](t),this}},{key:"fail",value:function(t){return this.then(k["default"].onFail(t))}},{key:"success",value:function(t){return this.then(k["default"].onSuccess(t))}},{key:"then",value:function(t){return this.q=this.q.then(t),this}}]),t}();e["default"]=z},function(t,e){"use strict";function n(t,e){return function(n){return e(n)&&(n=t(n)),n}}function r(t,e){return n(t,function(t){return t.status>=400})}function i(t,e){return n(t,function(t){return t.status<400})}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]={buildCallback:n,onFail:r,onSuccess:i}},function(t,e){"use strict";function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(i,o){try{var u=e[i](o),a=u.value}catch(c){return void n(c)}return u.done?void t(a):Promise.resolve(a).then(function(t){return r("next",t)},function(t){return r("throw",t)})}return r("next")})}}function r(t){return t._bodyBlob.type.includes("application/json")}function i(t){return function(){var e=n(regeneratorRuntime.mark(function i(e){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=6;break}return n.next=3,e[t]();case 3:e.data=n.sent,n.next=10;break;case 6:if(!r(e)){n.next=10;break}return n.next=9,e.json();case 9:e.data=n.sent;case 10:return n.abrupt("return",e);case 11:case"end":return n.stop()}},i,this)}));return function(t){return e.apply(this,arguments)}}()}function o(t){if(t)return{Accept:"application/json","Content-Type":"application/json"}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]={bodyContainsJson:r,parse:i,request:o}},function(t,e){"use strict";function n(t){return t.toString().replace(r,"")}Object.defineProperty(e,"__esModule",{value:!0});var r=new RegExp(/\?.*$/);e.filterParams=n},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(){return{counter:0,sent:0,received:0}}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e,r){n(this,t),u.call(this),this.check=void 0===r||r,this.key=e,this.id=t.inc(e)}return i(t,[{key:"keyIsOyutdated",value:function(e){return this.check&&t.get(this.key)[e]>this.id}}]),t}();o.map={},o.get=function(t){return this.map[t]||(this.map[t]=r())},o.inc=function(t){return this.get(t).counter+=1};var u=function(){var t=this;this.sentIsOutdated=function(){return t.keyIsOyutdated("sent")},this.receivedIsOutdated=function(){return t.keyIsOyutdated("received")},this.sent=function(){var e=o.get(t.key);if(e.sent<t.id)return e.sent=t.id},this.received=function(){var e=o.get(t.key);if(e.received<t.id)return e.received=t.id}};e["default"]=o},function(t,e){"use strict";function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(i,o){try{var u=e[i](o),a=u.value}catch(c){return void n(c)}return u.done?void t(a):Promise.resolve(a).then(function(t){return r("next",t)},function(t){return r("throw",t)})}return r("next")})}}function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=e.action,o=e.priority,u=void 0===o?0:o,a=r(e,["action","priority"]);i(this,t),this.action=n,this.priority=u,this.options=a}return o(t,[{key:"execute",value:function(){function t(t){return e.apply(this,arguments)}var e=n(regeneratorRuntime.mark(function r(t){var e;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.action();case 2:return e=n.sent,t&&"function"==typeof t&&t(e),n.abrupt("return",e);case 5:case"end":return n.stop()}},r,this)}));return t}()}]),t}();e["default"]=u},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){var n=t.priority,r=e.priority;return void 0!==n&&n>r}Object.defineProperty(e,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(11),s=r(c),f=n(3),l=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=e.strategy,r=void 0===n?o:n,u=e.debug;i(this,t),this.queue=new s["default"](r),this.debug=u}return a(t,[{key:"add",value:function(t){if("object"===("undefined"==typeof t?"undefined":u(t))&&"function"==typeof t.action)return this.queue.add(t),t}},{key:"get",value:function(){return(0,f.log)("Queue","getting a job",{size:this.size}),this.queue.poll()}},{key:"isEmpty",value:function(){return this.queue.isEmpty()}},{key:"cleanup",value:function(){return this.queue.trim()}},{key:"size",get:function(){return this.queue.size}}]),t}();e["default"]=l},function(t,e,n){(function(t){"use strict";function e(t){this.array=[],this.size=0,this.compare=t||r}var r=function(t,e){return t<e};e.prototype.add=function(t){var e=this.size;for(this.array[this.size++]=t;e>0;){var n=e-1>>1,r=this.array[n];if(!this.compare(t,r))break;this.array[e]=r,e=n}this.array[e]=t},e.prototype.heapify=function(t){this.array=t,this.size=t.length;for(var e=this.size>>1;e>=0;e--)this._percolateDown(e)},e.prototype._percolateUp=function(t){for(var e=this.array[t];t>0;){var n=t-1>>1,r=this.array[n];if(!this.compare(e,r))break;this.array[t]=r,t=n}this.array[t]=e},e.prototype._percolateDown=function(t){for(var e=this.size,n=this.size>>>1,r=this.array[t];t<n;){var i=(t<<1)+1,o=i+1,u=this.array[i];if(o<e&&this.compare(this.array[o],u)&&(i=o,u=this.array[o]),!this.compare(u,r))break;this.array[t]=u,t=i}this.array[t]=r},e.prototype.peek=function(t){return this.array[0]},e.prototype.poll=function(t){var e=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):--this.size,e},e.prototype.trim=function(){this.array=this.array.slice(0,this.size)},e.prototype.isEmpty=function(t){return 0==this.size};var i=function(){var t=new e(function(t,e){return t<e});for(t.add(1),t.add(0),t.add(5),t.add(4),t.add(3);!t.isEmpty();)console.log(t.poll())};n.c[0]===t&&i(),t.exports=e}).call(e,n(12)(t))},function(t,e){"use strict";t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){var r=this,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=i.sleep,u=void 0===o?50:o,a=i.max,c=void 0===a?8:a;n(this,t),this.start=function(){for(;r.available&&r.hasJob;){r.pending+=1;var t=r.queue.get();r.dispatch(r.execute,t)}r.queue.cleanup(),setTimeout(r.start,r.sleep)},this.execute=function(t){return t.execute(r.complete)},this.complete=function(){r.pending-=1},this.queue=e,this.sleep=u,this.max=c,this.pending=0,this.start()}return r(t,[{key:"dispatch",value:function(t,e){return setTimeout(t,0,e)}},{key:"available",get:function(){return this.pending<this.max}},{key:"hasJob",get:function(){return!this.queue.isEmpty()}}]),t}();e["default"]=i}])});
//# sourceMappingURL=index.js.map