!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Orderly",[],t):"object"==typeof exports?exports.Orderly=t():e.Orderly=t()}(this,function(){return function(e){function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}var t={};return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.p="",__webpack_require__(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";e.exports=r(2)},function(e,t,r){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function Orderly(){function ajax(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=new i["default"](e,t),n=new a["default"]({action:r.execute,priority:t.priority});return s.add(n),r}function get(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return ajax(e,Object.assign(t,{method:"GET"}))}function post(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return ajax(e,Object.assign(t,{method:"POST"}))}function put(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return ajax(e,Object.assign(t,{method:"PUT"}))}function del(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return ajax(e,Object.assign(t,{method:"DELETE"}))}var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.debug,r=e.max,o=e.sleep;(0,n.setMode)(t);var s=new c["default"],u=new l["default"](s,{max:r,sleep:o});return{ajax:ajax,get:get,post:post,put:put,del:del,queue:s,worker:u}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),o=r(4),i=_interopRequireDefault(o),s=r(10),a=_interopRequireDefault(s),u=r(11),c=_interopRequireDefault(u),f=r(14),l=_interopRequireDefault(f);t["default"]=Orderly},function(e,t){"use strict";function setMode(e){return n=e}function getMode(){return n}function log(e,t){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(n){var i=Object.keys(o).reduce(function(e,t){var n=o[t];return"object"===("undefined"==typeof n?"undefined":r(n))&&(n=JSON.stringify(n)),e+" "+t+":"+n},e);i=i+" "+t,console.log(i)}}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},n=!1;t.setMode=setMode,t.getMode=getMode,t.log=log},function(e,t,r){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _objectWithoutProperties(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function logAction(e,t,r){(0,c.log)("Ajax",e,{url:t.key,id:t.id,priority:r})}function anyConditionMet(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return e.some(function(e){return e.apply(void 0,r)})}function shouldSkip(e,t,r){return e!==!1&&(anyConditionMet(t)||r.sentIsOutdated())}function shouldCancel(e,t,r,n,o){return anyConditionMet(t,e)||r.receivedIsOutdated()?(logAction("CANCELLED",r,n),e=i({},e,{status:p}),o(e)):void logAction("RECEIVED",r,n)}function insertVersion(e,t,r){e[t]=r}function initHeader(e,t,r){return i({},e,(0,a.requestContentType)(t,r))}function initBody(e,t){return!e||"object"!==("undefined"==typeof e?"undefined":o(e))&&"json"!==t?e:JSON.stringify(e)}function initRequest(e,t){var r=t.headers,n=t.body,o=t.type,s=_objectWithoutProperties(t,["headers","body","type"]);return r=initHeader(r,n,o),n=initBody(n,o),i({},s,{headers:r,body:n})}function initAction(e,t,r,n){var o=r.type,i=r.priority,u=r.skip;return function(r,c){return function(f){return shouldSkip(u,f,n)?(logAction("SKIPPED",n,i),c({status:d})):(n.sent(),logAction("SENT",n,i),fetch(e,t).then((0,s.proxy)(shouldCancel,f,n,i,c)).then((0,s.proxy)(n.received)).then((0,s.proxy)(insertVersion,h,n)).then((0,a.parseResponse)(o,r,c))["catch"](c))}}}function initExecute(e,t){return function(){return e(t)}}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=r(5),a=r(6),u=r(7),c=r(3);r(8);var f=r(9),l=_interopRequireDefault(f),d="skipped",p="cancelled",h="_v",y=function(){function Ajax(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=r.version,o=_objectWithoutProperties(r,["version"]);_classCallCheck(this,Ajax),n=new l["default"]((0,u.filterParams)(e),n);var i=initRequest(e,o),s=initAction(e,i,o,n);this.conditions=[],this.q=new Promise(function(e,r){s=s(e,r),t.execute=initExecute(s,t.conditions)}),logAction("CREATED",n,o.priority)}return n(Ajax,[{key:"cancel",value:function(e){return this.conditions.push(e),this}},{key:"catch",value:function(e){return this.q=this.q["catch"](e),this}},{key:"fail",value:function(e){return this.then((0,s.onFail)(e))}},{key:"success",value:function(e){return this.then((0,s.onSuccess)(e))}},{key:"then",value:function(e){return this.q=this.q.then(e),this}}]),Ajax}();t["default"]=y},function(e,t){"use strict";function proxy(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return function(t){return e.apply(void 0,[t].concat(r)),t}}function proxyWithCondition(e,t){return function(r){return t(r)&&(r=e(r)),r}}function onFail(e,t){return proxyWithCondition(e,function(e){return e.status>=400})}function onSuccess(e,t){return proxyWithCondition(e,function(e){return e.status<400})}Object.defineProperty(t,"__esModule",{value:!0}),t.proxy=proxy,t.proxyWithCondition=proxyWithCondition,t.onFail=onFail,t.onSuccess=onSuccess},function(e,t){"use strict";function bodyContainsJson(e){var t=e.headers.get("Content-Type");return t&&t.includes(n.json)}function parseResponse(e,t,r){return function(n){!e&&bodyContainsJson(n)&&(e="json"),n[e]().then(function(e){n.data=e,t(n)})["catch"](r)}}function accepts(e){if("json"===e)return{Accept:n.json}}function contentType(e,t){if(e&&"object"===("undefined"==typeof e?"undefined":r(e))||"json"===t)return{"Content-Type":n.json}}function requestContentType(e,t){return Object.assign({},accepts(t),contentType(e,t))}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},n={json:"application/json"};t.parseResponse=parseResponse,t.requestContentType=requestContentType},function(e,t){"use strict";function filterParams(e){return e.toString().replace(r,"")}Object.defineProperty(t,"__esModule",{value:!0});var r=new RegExp(/\?.*$/);t.filterParams=filterParams},function(e,t){"use strict";!function(e){function normalizeName(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function normalizeValue(e){return"string"!=typeof e&&(e=String(e)),e}function iteratorFor(e){var r={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(r[Symbol.iterator]=function(){return r}),r}function Headers(e){this.map={},e instanceof Headers?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function consumed(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function fileReaderReady(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function readBlobAsArrayBuffer(e){var t=new FileReader;return t.readAsArrayBuffer(e),fileReaderReady(t)}function readBlobAsText(e){var t=new FileReader;return t.readAsText(e),fileReaderReady(t)}function Body(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(e){if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob?(this.blob=function(){var e=consumed(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(readBlobAsArrayBuffer)},this.text=function(){var e=consumed(this);if(e)return e;if(this._bodyBlob)return readBlobAsText(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=consumed(this);return e?e:Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}function normalizeMethod(e){var t=e.toUpperCase();return r.indexOf(t)>-1?t:e}function Request(e,t){t=t||{};var r=t.body;if(Request.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new Headers(e.headers)),this.method=e.method,this.mode=e.mode,r||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new Headers(t.headers)),this.method=normalizeMethod(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function decode(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}}),t}function headers(e){var t=new Headers,r=(e.getAllResponseHeaders()||"").trim().split("\n");return r.forEach(function(e){var r=e.trim().split(":"),n=r.shift().trim(),o=r.join(":").trim();t.append(n,o)}),t}function Response(e,t){t||(t={}),this.type="default",this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof Headers?t.headers:new Headers(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};Headers.prototype.append=function(e,t){e=normalizeName(e),t=normalizeValue(t);var r=this.map[e];r||(r=[],this.map[e]=r),r.push(t)},Headers.prototype["delete"]=function(e){delete this.map[normalizeName(e)]},Headers.prototype.get=function(e){var t=this.map[normalizeName(e)];return t?t[0]:null},Headers.prototype.getAll=function(e){return this.map[normalizeName(e)]||[]},Headers.prototype.has=function(e){return this.map.hasOwnProperty(normalizeName(e))},Headers.prototype.set=function(e,t){this.map[normalizeName(e)]=[normalizeValue(t)]},Headers.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(r){this.map[r].forEach(function(n){e.call(t,n,r,this)},this)},this)},Headers.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),iteratorFor(e)},Headers.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),iteratorFor(e)},Headers.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),iteratorFor(e)},t.iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var r=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];Request.prototype.clone=function(){return new Request(this)},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var e=new Response(null,{status:0,statusText:""});return e.type="error",e};var n=[301,302,303,307,308];Response.redirect=function(e,t){if(n.indexOf(t)===-1)throw new RangeError("Invalid status code");return new Response(null,{status:t,headers:{location:e}})},e.Headers=Headers,e.Request=Request,e.Response=Response,e.fetch=function(e,r){return new Promise(function(n,o){function responseURL(){return"responseURL"in s?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):void 0}var i;i=Request.prototype.isPrototypeOf(e)&&!r?e:new Request(e,r);var s=new XMLHttpRequest;s.onload=function(){var e={status:s.status,statusText:s.statusText,headers:headers(s),url:responseURL()},t="response"in s?s.response:s.responseText;n(new Response(t,e))},s.onerror=function(){o(new TypeError("Network request failed"))},s.ontimeout=function(){o(new TypeError("Network request failed"))},s.open(i.method,i.url,!0),"include"===i.credentials&&(s.withCredentials=!0),"responseType"in s&&t.blob&&(s.responseType="blob"),i.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send("undefined"==typeof i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:void 0)},function(e,t){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function initValue(){return{counter:0,sent:0,received:0}}Object.defineProperty(t,"__esModule",{value:!0});var r=function Version(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1];_classCallCheck(this,Version),n.call(this),this.check=t,this.key=e,this.id=Version.inc(e)};r.map={},r.get=function(e){return this.map[e]||(this.map[e]=initValue())},r.inc=function(e){return this.get(e).counter+=1};var n=function(){var e=this;this.sentIsOutdated=function(){return e.check&&r.get(e.key).sent>e.id},this.receivedIsOutdated=function(){return e.check&&r.get(e.key).received>e.id},this.sent=function(){var t=r.get(e.key);if(e.id>t.sent)return t.sent=e.id},this.received=function(){var t=r.get(e.key);if(e.id>t.received)return t.received=e.id}};t["default"]=r},function(e,t){"use strict";function _objectWithoutProperties(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function Job(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=t.action,n=t.priority,o=void 0===n?0:n,i=_objectWithoutProperties(t,["action","priority"]);_classCallCheck(this,Job),this.execute=function(t){var r=e.action();return t&&"function"==typeof t&&(r=r&&r instanceof Promise?r.then(t):t(r)),r},this.action=r,this.priority=o,this.options=i};t["default"]=r},function(e,t,r){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function defaultStrategy(e,t){var r=e.priority,n=t.priority;return void 0===n||r>n}Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}(),i=r(12),s=_interopRequireDefault(i),a=r(3),u=function(){function Queue(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.strategy,r=void 0===t?defaultStrategy:t;_classCallCheck(this,Queue),this.queue=new s["default"](r)}return o(Queue,[{key:"add",value:function(e){if("object"===("undefined"==typeof e?"undefined":n(e))&&"function"==typeof e.execute)return this.queue.add(e),e;throw new Error("trying to insert an invalid job",e)}},{key:"get",value:function(){return(0,a.log)("Queue","getting a job",{size:this.size()}),this.queue.poll()}},{key:"isEmpty",value:function(){return this.queue.isEmpty()}},{key:"size",value:function(){return this.queue.size}},{key:"cleanup",value:function(){return this.queue.trim()}}]),Queue}();t["default"]=u},function(e,t,r){(function(e){"use strict";function FastPriorityQueue(e){this.array=[],this.size=0,this.compare=e||t}var t=function(e,t){return e<t};FastPriorityQueue.prototype.add=function(e){var t=this.size;for(this.array[this.size++]=e;t>0;){var r=t-1>>1,n=this.array[r];if(!this.compare(e,n))break;this.array[t]=n,t=r}this.array[t]=e},FastPriorityQueue.prototype.heapify=function(e){this.array=e,this.size=e.length;for(var t=this.size>>1;t>=0;t--)this._percolateDown(t)},FastPriorityQueue.prototype._percolateUp=function(e){for(var t=this.array[e];e>0;){var r=e-1>>1,n=this.array[r];if(!this.compare(t,n))break;this.array[e]=n,e=r}this.array[e]=t},FastPriorityQueue.prototype._percolateDown=function(e){for(var t=this.size,r=this.size>>>1,n=this.array[e];e<r;){var o=(e<<1)+1,i=o+1,s=this.array[o];if(i<t&&this.compare(this.array[i],s)&&(o=i,s=this.array[i]),!this.compare(s,n))break;this.array[e]=s,e=o}this.array[e]=n},FastPriorityQueue.prototype.peek=function(e){return this.array[0]},FastPriorityQueue.prototype.poll=function(e){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):--this.size,t},FastPriorityQueue.prototype.trim=function(){this.array=this.array.slice(0,this.size)},FastPriorityQueue.prototype.isEmpty=function(e){return 0==this.size};var n=function(){var e=new FastPriorityQueue(function(e,t){return e<t});for(e.add(1),e.add(0),e.add(5),e.add(4),e.add(3);!e.isEmpty();)console.log(e.poll())};r.c[0]===e&&n(),e.exports=FastPriorityQueue}).call(t,r(13)(e))},function(e,t){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function isFree(e,t){return e<=t}function hasJob(e){return!e.isEmpty()}function dispatch(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return setTimeout.apply(void 0,[e,0].concat(r))}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}(),n=function(){function Worker(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=t.sleep,n=void 0===r?50:r,i=t.max,s=void 0===i?8:i;_classCallCheck(this,Worker),o.call(this),this.pending=0,this["continue"]=!0,this.start(e,n,s)}return r(Worker,[{key:"stop",value:function(){this["continue"]=!1,clearTimeout(this.setTimeout)}}]),Worker}(),o=function(){var e=this;this.start=function(t,r,n){for(;e["continue"]&&isFree(e.pending,n)&&hasJob(t);){e.pending+=1;var o=t.get();dispatch(o.execute,e.complete)}e["continue"]&&(t.cleanup(),e.setTimeout=setTimeout(e.start,r,t,r,n))},this.complete=function(){e.pending-=1}};t["default"]=n}])});
//# sourceMappingURL=index.js.map